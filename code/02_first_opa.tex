\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={OPA for Wealth Tax},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{OPA for Wealth Tax}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{}
    \preauthor{}\postauthor{}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{07 March, 2019}

\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# - inputs: none}
\CommentTok{# - outputs: all the original source values}
\NormalTok{call_params_f <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{()\{}
  
  
  
    \CommentTok{################  }
    \CommentTok{####### Research:}
    \CommentTok{################  }
\NormalTok{    research_so <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(}\StringTok{"rawdata/edits/research.csv"}\NormalTok{)      }\CommentTok{#load data set that contains parameters from research}
    \CommentTok{# Elasticities}
\NormalTok{    ela1_so <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(research_so[}\DecValTok{1}\NormalTok{,}\StringTok{"param"}\NormalTok{])           }\CommentTok{# 0.5 - David. 2017}
\NormalTok{    ela2_so <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(research_so[}\DecValTok{2}\NormalTok{,}\StringTok{"param"}\NormalTok{])           }\CommentTok{# 0.5 - Jakobsen et al. 2018}
\NormalTok{    ela3_}\DecValTok{1}\NormalTok{_so <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(research_so[}\DecValTok{3}\NormalTok{,}\StringTok{"param"}\NormalTok{])         }\CommentTok{# 2   - Londono-Velez 2018}
\NormalTok{    ela3_}\DecValTok{2}\NormalTok{_so <-}\StringTok{   }\KeywordTok{as.numeric}\NormalTok{(research_so[}\DecValTok{4}\NormalTok{,}\StringTok{"param"}\NormalTok{])       }\CommentTok{# 3   - Londono-Velez 2018}
\NormalTok{    ela4_}\DecValTok{1}\NormalTok{_so <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(research_so[}\DecValTok{5}\NormalTok{,}\StringTok{"param"}\NormalTok{])         }\CommentTok{# 23  - Brülhart et al. 2016}
\NormalTok{    ela4_}\DecValTok{2}\NormalTok{_so <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(research_so[}\DecValTok{6}\NormalTok{,}\StringTok{"param"}\NormalTok{])         }\CommentTok{# 34  - Brülhart et al. 2016}
    
    \CommentTok{################}
    \CommentTok{###### Data:}
    \CommentTok{################ }
    \CommentTok{# Tax base called from data (SCF and DINA) already accounts for the adjustments}
    \CommentTok{# due to population growth, tax avoidance, }
    \CommentTok{# Number of tax payers SCF & DINA}
\NormalTok{    cum_numberTaxpayers_scf_so <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1100144}\NormalTok{, }\DecValTok{298649}\NormalTok{, }\DecValTok{72143}\NormalTok{, }\DecValTok{34552}\NormalTok{, }\DecValTok{7119}\NormalTok{,  }\DecValTok{2555}\NormalTok{,  }\DecValTok{671}\NormalTok{)}
\NormalTok{    cum_numberTaxpayers_dina_so <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{673449}\NormalTok{, }\DecValTok{194548}\NormalTok{, }\DecValTok{78434}\NormalTok{, }\DecValTok{32751}\NormalTok{, }\DecValTok{10236}\NormalTok{, }\DecValTok{4491}\NormalTok{, }\DecValTok{1597}\NormalTok{) }
    \CommentTok{# Tax base for brackets_po below}
\NormalTok{    cum_tax_base_scf_so <-}\StringTok{  }\KeywordTok{c}\NormalTok{(}\FloatTok{203.97}\NormalTok{, }\FloatTok{121.63}\NormalTok{,  }\FloatTok{81.79}\NormalTok{, }\FloatTok{59.18}\NormalTok{, }\FloatTok{36.67}\NormalTok{, }\FloatTok{27.46}\NormalTok{, }\FloatTok{20.78}\NormalTok{)}
\NormalTok{    cum_tax_base_dina_so <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{187.35}\NormalTok{, }\FloatTok{135.38}\NormalTok{, }\FloatTok{105.02}\NormalTok{, }\FloatTok{80.11}\NormalTok{, }\FloatTok{53.43}\NormalTok{, }\FloatTok{36.94}\NormalTok{, }\FloatTok{23.39}\NormalTok{)}
    \CommentTok{# Total wealth and number if households [SOURCE NEEDED]}
\NormalTok{    total_wealth_so <-}\StringTok{ }\FloatTok{94e12}   \CommentTok{# [SOURCE]  }
\NormalTok{    total_hhlds_so <-}\StringTok{ }\FloatTok{129.4e6}  \CommentTok{# [SOURCE]}
    \CommentTok{# Forbes: average across 400 and value for 400th billionare}
\NormalTok{    average_wealth_top_}\DecValTok{400}\NormalTok{_so <-}\StringTok{ }\FloatTok{7.2e9}
\NormalTok{    wealth_last_}\DecValTok{400}\NormalTok{_so <-}\StringTok{ }\FloatTok{2.1e9}
    \CommentTok{# Macro-economy/demographics}
\NormalTok{    inflation_so <-}\StringTok{ }\FloatTok{0.025}      \CommentTok{# CBO/JCT}
\NormalTok{    population_gr_so <-}\StringTok{ }\FloatTok{0.01}   \CommentTok{# CBO/JCT}
\NormalTok{    real_growth_so <-}\StringTok{ }\FloatTok{0.02}     \CommentTok{# CBO/JCT}
\NormalTok{    is_dina_public_so <-}\StringTok{ }\OtherTok{TRUE}
    
    \CommentTok{################ }
    \CommentTok{#####  Guesswork:}
    \CommentTok{################ }
\NormalTok{    hhld_gr_so <-}\StringTok{ }\FloatTok{0.009}
\NormalTok{    growth_wealth_so <-}\StringTok{ }\FloatTok{0.055}

    \KeywordTok{return}\NormalTok{( }\KeywordTok{sapply}\NormalTok{( }\KeywordTok{ls}\NormalTok{(}\DataTypeTok{pattern=} \StringTok{"_so}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{b"}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{get}\NormalTok{(x) ) ) }
\NormalTok{\}}
\KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{call_params_f}\NormalTok{(),.GlobalEnv) )}


\CommentTok{################ }
\CommentTok{#####  Notes:}
\CommentTok{################ }
\CommentTok{### Source ---------->  Input ---------->  Model ---------->  Policy Estimates (output)}
\CommentTok{###  (_so)              (_in)              (_mo)                (_pe)}
\CommentTok{### values            functions          functions              values}
\CommentTok{###                   & values           & values             }
\CommentTok{# - call_params_f - tax_elasticity_in_f  - tax_revenue_mo_f     - ten_year_revenue_pe}
\CommentTok{# - policy_f      - est_billionares_in_f - total_rev_mo_f       - ten_year_top_tax_pe}
\CommentTok{#                                        - ten_years_mo_f       - total_rev_pe}
\CommentTok{### arguments in functions should used "_var" and functions should "_f"}
\end{Highlighting}
\end{Shaded}

\hypertarget{policy-choices}{%
\subsubsection{1 - Policy choices}\label{policy-choices}}

The wealth tax applies to net worth (sum of all assets net of debts)
above \$50 million dollars, and follows the following structure:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# - inputs: none}
\CommentTok{# - outputs: all the original source values}
\CommentTok{#### Policy:  }
\NormalTok{policy_f <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{()\{}
  
  
  
    \CommentTok{# brackets_po}
\NormalTok{    brackets_po <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{25}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{250}\NormalTok{, }\DecValTok{500}\NormalTok{,  }\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}
\NormalTok{    tax_rates_po <-}\StringTok{ }\KeywordTok{c}\NormalTok{(  }\DecValTok{0}\NormalTok{,    }\DecValTok{0}\NormalTok{, }\FloatTok{0.02}\NormalTok{,  }\FloatTok{0.02}\NormalTok{,  }\FloatTok{0.02}\NormalTok{,  }\FloatTok{0.02}\NormalTok{, }\FloatTok{0.03}\NormalTok{) }
\NormalTok{    starting_brack_po <-}\StringTok{ }\NormalTok{brackets_po[}\KeywordTok{min}\NormalTok{(}\KeywordTok{which}\NormalTok{(tax_rates_po}\OperatorTok{>}\DecValTok{0}\NormalTok{))]}
\NormalTok{    next_increase_po <-}\StringTok{ }\NormalTok{brackets_po[}\KeywordTok{min}\NormalTok{(}\KeywordTok{which}\NormalTok{(tax_rates_po}\OperatorTok{>}\FloatTok{0.02}\NormalTok{))]}
\NormalTok{    main_tax_po <-}\StringTok{ }\KeywordTok{median}\NormalTok{(tax_rates_po)}
\NormalTok{    max_tax_po <-}\StringTok{ }\KeywordTok{max}\NormalTok{(tax_rates_po)}
    
    
    
    \KeywordTok{return}\NormalTok{( }\KeywordTok{sapply}\NormalTok{( }\KeywordTok{ls}\NormalTok{(}\DataTypeTok{pattern=} \StringTok{"_po}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{b"}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{get}\NormalTok{(x)) ) }
\NormalTok{\}}
\KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{policy_f}\NormalTok{(),.GlobalEnv) )}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\StringTok{"Bracket (millions of $)"}\NormalTok{ =}\StringTok{ }\NormalTok{brackets_po}\OperatorTok{/}\FloatTok{1e6}\NormalTok{,}\StringTok{"Marginal Tax Rate (%)"}\NormalTok{ =}\StringTok{ }\DecValTok{100}\OperatorTok{*}\NormalTok{tax_rates_po) )}\OperatorTok{%>%}
\StringTok{  }\KeywordTok{kable_styling}\NormalTok{()  }
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}{r|r}
\hline
Bracket (millions of \$) & Marginal Tax Rate (\%)\\
\hline
10 & 0\\
\hline
25 & 0\\
\hline
50 & 2\\
\hline
100 & 2\\
\hline
250 & 2\\
\hline
500 & 2\\
\hline
1000 & 3\\
\hline
\end{tabular}
\end{table}

Household net worth above \$50 million would be taxed at 2\%. Any wealth
over \$1 billion would be taxed an additional 1\% (a billionaire
surtax).

\hypertarget{compute-tax-avoidance-elasticity}{%
\subsubsection{2 - Compute tax avoidance
elasticity}\label{compute-tax-avoidance-elasticity}}

To calculate the tax revenue from this wealth tax, the extent of wealth
tax evasion/avoidance is estimated based on recent research. Recent
research shows that the extent of wealth tax evasion/avoidance depends
crucially on loopholes and enforcement. The tax-avoidance elasticity is
computed as the average elasticity from four studies. The table lists
the four studies and the avoidance/evasion response to a 1\% wealth tax.

\begin{tabu} to \linewidth {>{\raggedright}X>{\raggedleft}X>{\raggedright}X>{\raggedright}X>{\raggedright}X}
\toprule
Authors & Year & paper & Publisher & Avoidance/evasion response\\
\midrule
Seim, David & 2017 & "Behavioral Responses to an Annual Wealth Tax: Evidence from Sweden" & American Economic Journal: Economic Policy, 9(4), 395-421 & 0.5\\
Jakobsen, Kristian, Katrine Jakobsen, Henrik Kleven and Gabriel Zucman. & 2018 & “Wealth Accumulation and Wealth Taxation: Theory and Evidence from Denmark” & NBER working paper No. 24371 & 0.5\\
Londono-Velez, Juliana and Javier Avila. & 2018 & "Can Wealth Taxation Work in Developing Countries? Quasi-Experimental Evidence from Colombia" & UC Berkeley working paper & 2-3\\
Brülhart, Marius, Jonathan Gruber, Matthias Krapf, and Kurt Schmidheiny. & 2016 & “Taxing Wealth: Evidence from Switzerland” & NBER working paper No. 22376, 2016 & 23-34\\
\bottomrule
\end{tabu}

Seim (2017) and Jakobsen et al. (2018) obtain small avoidance/evasion
responses in the case of Sweden and Denmark, two countries with
systematic third party reporting of wealth: a 1\% wealth tax reduces
reported wealth by less than 1\%. Londono-Velez and Avila (2018) show
medium avoidance/evasion responses in the case of Colombia where
enforcement is not as strong: a 1\% wealth tax reduces reported wealth
by about 2-3\%. The study for Switzerland, Brülhart et al. (2016) is an
outlier that finds very large responses to wealth taxation in
Switzerland: a 1\% wealth tax lowers reported wealth by 23-34\%. This
extremely large estimate is extrapolated from very small variations in
wealth tax rates over time and across Swiss cantons and hence is not as
compellingly identified as the other estimates based on large variations
in the wealth tax rate. Switzerland has no systematic third party
reporting of assets which can also make tax evasion responses larger
than in Scandinavia.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# input: elasticity parameters from research, main tax, adjutment factor}
\CommentTok{# ouptut: final elasticity (final_ela_in), evasion parameter (evasion_param_in) }
\NormalTok{tax_elasticity_in_f <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{ela1_var =}\NormalTok{ ela1_so, }\DataTypeTok{ela2_var =}\NormalTok{ ela2_so, }\DataTypeTok{ela3_1_var =}\NormalTok{ ela3_}\DecValTok{1}\NormalTok{_so, }
                                \DataTypeTok{ela3_2_var =}\NormalTok{ ela3_}\DecValTok{2}\NormalTok{_so, }\DataTypeTok{ela4_1_var =}\NormalTok{ ela4_}\DecValTok{1}\NormalTok{_so, }\DataTypeTok{ela4_2_var =}\NormalTok{ ela4_}\DecValTok{2}\NormalTok{_so,}
                                \DataTypeTok{main_tax_var =}\NormalTok{ main_tax_po)\{}
  
  
  
\NormalTok{    final_ela_in <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(ela1_var, ela2_var, (ela3_}\DecValTok{1}\NormalTok{_var }\OperatorTok{+}\StringTok{ }\NormalTok{ela3_}\DecValTok{2}\NormalTok{_var)}\OperatorTok{/}\DecValTok{2}\NormalTok{, (ela4_}\DecValTok{1}\NormalTok{_var }\OperatorTok{+}\StringTok{ }\NormalTok{ela4_}\DecValTok{2}\NormalTok{_var)}\OperatorTok{/}\DecValTok{2}\NormalTok{))}
\NormalTok{    evasion_param_in <-}\StringTok{ }\NormalTok{main_tax_var }\OperatorTok{*}\StringTok{ }\NormalTok{final_ela_in}
    
    
    
    \KeywordTok{return}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\StringTok{"final_ela_in"}\NormalTok{ =}\StringTok{ }\NormalTok{final_ela_in, }
                \StringTok{"evasion_param_in"}\NormalTok{ =}\StringTok{ }\NormalTok{evasion_param_in))}
\NormalTok{\}}
\KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{tax_elasticity_in_f}\NormalTok{(),.GlobalEnv) ) }

\CommentTok{# ls(pattern = "_in\textbackslash{}\textbackslash{}b|_in_") }
\end{Highlighting}
\end{Shaded}

The final 16\% tax avoidance/evasion response to a 2\% wealth tax was
computed as and average across these four studies
(2\%*(0.5+0.5+2.5+28.5)/4)

\hypertarget{data-sources}{%
\subsubsection{3 - Data Sources}\label{data-sources}}

Three data sources were used in this analysis:

\begin{itemize}
\tightlist
\item
  \href{https://www.federalreserve.gov/econres/scfindex.htm}{Survey of
  Consumer Finances (SCF)} from the Federal Reserve Board. Latest year
  available: 2016.\\
\item
  \href{http://gabriel-zucman.eu/usdina/}{Distributional National
  Accounts (DINA)}: estimates wealth by capitalizing investment income
  from income tax returns. Latest year available: 2019.\\
\item
  \href{https://www.forbes.com/forbes-400/\#4d358acf7e2f}{Forbes 400}:
  provides the best estimate of billionares in the US. Last year
  available: 2018.
\end{itemize}

\hypertarget{data-cleanning}{%
\paragraph{3.1 Data cleanning}\label{data-cleanning}}

From each data set three variable were extracted: \texttt{networth} that
contain information on wealth, \texttt{weigths} represents the number of
households that each observation represents and \texttt{data} which
tracks the data of origin.

The following transformations were applied to the data:

\begin{itemize}
\tightlist
\item
  Each observation in DINA is aggregated into broups of 5 observations
  to anonymize the data.\\
\item
  SCF was aged by inflating the number of households and wealth
  uniformly to match the aggregate projections for population and total
  household wealth from the Federal Reserve Board. After that, SCF
  wealth was scaled to match the total of DINA minus the wealth of
  Forbes (to prevent double counting of wealth).\\
\item
  After combinind (appending) all three data sources, the population
  weights of SCF and DINA where combined by the taking the average.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{##### Reproducing do file ('wealthtax.do')}
\CommentTok{### Forbes data }
\NormalTok{df_forbes <-}\StringTok{ }\KeywordTok{read_dta}\NormalTok{(}\StringTok{"rawdata/forbes_20112018_bdays.dta"}\NormalTok{)}
\NormalTok{df_forbes1 <-}\StringTok{ }\NormalTok{df_forbes  }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(forbes_yr }\OperatorTok{==}\StringTok{ }\DecValTok{2018}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\StringTok{"networth"}\NormalTok{ =}\StringTok{ }\NormalTok{net_worthmillions }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }
           \StringTok{"weight"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }
           \StringTok{"data"}\NormalTok{ =}\StringTok{ "FB400"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(data, networth, weight) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{( }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(networth) )}
\NormalTok{forbesmin <-}\StringTok{ }\KeywordTok{min}\NormalTok{(df_forbes1}\OperatorTok{$}\NormalTok{networth)}
\NormalTok{f400tot <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(df_forbes1}\OperatorTok{$}\NormalTok{networth }\OperatorTok{*}\StringTok{ }\NormalTok{df_forbes1}\OperatorTok{$}\NormalTok{weight) }\OperatorTok{/}\StringTok{ }\FloatTok{1e12}
\CommentTok{#cat("TOTAL FORBES NETWORTH 2018 (Tr) = ", f400tot,  "FORBES MIN WEALTH 2018 = ", forbesmin)}


\CommentTok{### DINA data }
\CommentTok{####### This section uses data that cannot be shared for confidentiality reasons}
\CommentTok{####### Below is the code used to aggregate the data.}
\CommentTok{####### If you have access to the orginal data set, set is_dina_public_so = TRUE.}
\CommentTok{####### To obtain this data please contact Gabriel Zucman at zucman@gmail.com}
\CommentTok{####### The file that you will obtain should have the following signature:}
\CommentTok{####### in R: digest("usdina2019.dta", file = TRUE) produces: "2f5d529b1e89e39171927dc28bfebbe4"}
\CommentTok{####### in Stata: datasignature produces: 282866:4(49628):4083279708:1806586907}

\ControlFlowTok{if}\NormalTok{(is_dina_public_so)\{}
  \CommentTok{# paste below the path to where usdina2019.dta is in your computer}
\NormalTok{  df_dina_first <-}\StringTok{ }\KeywordTok{read_dta}\NormalTok{(}\StringTok{"/Users/fhoces/Desktop/opa-wealthtax_test/rawdata/materials/usdina2019.dta"}\NormalTok{)}
\NormalTok{  df_dina <-}\StringTok{ }\NormalTok{df_dina_first }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{group_by}\NormalTok{(id) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\StringTok{"networth"}\NormalTok{ =}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{sum}\NormalTok{(hweal)),  }\CommentTok{# rounding of networth is to make it compatible with Stata}
            \StringTok{"weight"}\NormalTok{ =}\StringTok{ }\KeywordTok{mean}\NormalTok{(dweght)}\OperatorTok{/}\FloatTok{1e5}\NormalTok{) }
    
\NormalTok{  totw_dina <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(df_dina}\OperatorTok{$}\NormalTok{networth }\OperatorTok{*}\StringTok{ }\NormalTok{df_dina}\OperatorTok{$}\NormalTok{weight) }\OperatorTok{/}\StringTok{ }\FloatTok{1e12}
  \CommentTok{#cat("TOTAL DINA NETWORTH 2019  (Tr) ", totw_dina)}
  
\NormalTok{  totn_dina <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(df_dina}\OperatorTok{$}\NormalTok{weight)}
  
\NormalTok{  df_dina}\OperatorTok{$}\NormalTok{data <-}\StringTok{ "DINA"}
  
  \CommentTok{# Aggregate into bins of 5 househodls info to protect confidentiality}
\NormalTok{  df_dina1 <-}\StringTok{ }\NormalTok{df_dina }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\StringTok{"aux_id"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(df_dina)[}\DecValTok{1}\NormalTok{]) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(networth),aux_id) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\CommentTok{# Still not clear what the role of the "+3" is.  }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\StringTok{"group"}\NormalTok{ =}\StringTok{ }\KeywordTok{floor}\NormalTok{((}\DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(df_dina)[}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{3}\NormalTok{) }\OperatorTok{/}\StringTok{ }\DecValTok{5}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{group_by}\NormalTok{(group) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{summarise}\NormalTok{(}\StringTok{"weight"}\NormalTok{ =}\StringTok{ }\KeywordTok{sum}\NormalTok{(weight),}
              \StringTok{"networth"}\NormalTok{ =}\StringTok{ }\KeywordTok{mean}\NormalTok{(networth)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\StringTok{"data"}\NormalTok{ =}\StringTok{ "DINA"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{select}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"networth"}\NormalTok{, }\StringTok{"weight"}\NormalTok{)}
  \KeywordTok{write_dta}\NormalTok{(}\StringTok{"analysis_data/dina.dta"}\NormalTok{, }\DataTypeTok{data =}\NormalTok{ df_dina1)}
\NormalTok{  df_dina1 <-}\StringTok{ }\KeywordTok{read_dta}\NormalTok{(}\StringTok{"analysis_data/dina.dta"}\NormalTok{)}
  \CommentTok{#### End of confidential section}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{  df_dina1 <-}\StringTok{ }\KeywordTok{read_dta}\NormalTok{(}\StringTok{"analysis_data/dina.dta"}\NormalTok{)}
\NormalTok{  totw_dina <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(df_dina1}\OperatorTok{$}\NormalTok{networth }\OperatorTok{*}\StringTok{ }\NormalTok{df_dina1}\OperatorTok{$}\NormalTok{weight) }\OperatorTok{/}\StringTok{ }\FloatTok{1e12}
\NormalTok{\}}

\CommentTok{### SCF data }
\NormalTok{df_scf <-}\StringTok{ }\KeywordTok{read_dta}\NormalTok{(}\StringTok{"rawdata/rscfp2016.dta"}\NormalTok{)}
\NormalTok{totw_scf <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(df_scf}\OperatorTok{$}\NormalTok{networth }\OperatorTok{*}\StringTok{ }\NormalTok{df_scf}\OperatorTok{$}\NormalTok{wgt) }\OperatorTok{/}\StringTok{ }\FloatTok{1e12}

\CommentTok{#cat("TOTAL SCF NETWORTH 2016  (Tr)", totw_scf)}
\CommentTok{# Increase the population weigths to reflect population growth from 2016 to 1019}
\NormalTok{df_scf <-}\StringTok{ }\NormalTok{df_scf }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\StringTok{"wgt2019"}\NormalTok{ =}\StringTok{ }\KeywordTok{round}\NormalTok{( wgt }\OperatorTok{*}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{hhld_gr_so)}\OperatorTok{^}\NormalTok{( }\DecValTok{2019} \OperatorTok{-}\StringTok{ }\DecValTok{2016}\NormalTok{ )))}
\NormalTok{totw <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(df_scf}\OperatorTok{$}\NormalTok{networth }\OperatorTok{*}\StringTok{ }\NormalTok{df_scf}\OperatorTok{$}\NormalTok{wgt2019) }\OperatorTok{/}\StringTok{ }\FloatTok{1e12}
\NormalTok{totn <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(df_scf}\OperatorTok{$}\NormalTok{wgt2019)}


\CommentTok{# Rescaling SCF to match total total wealth reported in DINA excluding the f400}
\NormalTok{df_scf1 <-}\StringTok{ }\NormalTok{df_scf }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\StringTok{"networth"}\NormalTok{ =}\StringTok{ }\NormalTok{networth }\OperatorTok{*}\StringTok{ }\NormalTok{( totw_dina }\OperatorTok{-}\StringTok{ }\NormalTok{f400tot ) }\OperatorTok{/}\StringTok{ }\NormalTok{totw, }
                            \StringTok{"weight"}\NormalTok{ =}\StringTok{ }\NormalTok{wgt2019, }
                            \StringTok{"data"}\NormalTok{ =}\StringTok{ "SCF"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(data, networth, weight)}

\CommentTok{# Combine three data sources}
\NormalTok{df <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(df_forbes1, df_scf1, df_dina1)}

\CommentTok{# If observation is in SCF or DINA, then divide their weights in 2}
\NormalTok{df}\OperatorTok{$}\NormalTok{weight <-}\StringTok{ }\KeywordTok{with}\NormalTok{(df, }\KeywordTok{ifelse}\NormalTok{(data}\OperatorTok{==}\StringTok{"SCF"} \OperatorTok{|}\StringTok{ }\NormalTok{data}\OperatorTok{==}\StringTok{"DINA"}\NormalTok{, }
                               \KeywordTok{round}\NormalTok{(weight}\OperatorTok{/}\DecValTok{2}\NormalTok{), weight) )}
\CommentTok{# All obs from SCF and DINA that have wealth above the min of forbes are droped to avoid duplications}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{( }\OperatorTok{!}\NormalTok{(networth }\OperatorTok{>}\StringTok{ }\NormalTok{forbesmin }\OperatorTok{&}\StringTok{ }\NormalTok{( data }\OperatorTok{==}\StringTok{ "SCF"} \OperatorTok{|}\StringTok{ }\NormalTok{data }\OperatorTok{==}\StringTok{ "DINA"}\NormalTok{ ) ) )}

\CommentTok{# df %>% }
\CommentTok{#   summarise( mean(networth), sd(networth) ) }

\NormalTok{total_wealth <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(networth }\OperatorTok{*}\StringTok{ }\NormalTok{weight) }\OperatorTok{/}\StringTok{ }\FloatTok{1e12}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{as.numeric}\NormalTok{()}
\NormalTok{billio_wealth <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(networth }\OperatorTok{>=}\StringTok{ }\FloatTok{50e6}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(networth }\OperatorTok{*}\StringTok{ }\NormalTok{weight) }\OperatorTok{/}\StringTok{ }\FloatTok{1e12}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{as.numeric}\NormalTok{()}

\CommentTok{#cat("Total wealth (in trillions) is ", total_wealth, ". Wealth for billionares total wealth is ", billio_wealth) }

\KeywordTok{write_dta}\NormalTok{(}\StringTok{"analysis_data/wealth.dta"}\NormalTok{, }\DataTypeTok{data =}\NormalTok{ df, }\DataTypeTok{version =} \DecValTok{11}\NormalTok{)}

\CommentTok{# Very small differences with stata output (but it should be zero differences)}
\CommentTok{# wealth <- read_dta("~/Downloads/wealthtaxsim/data/wealth.dta")}
\CommentTok{# diff_aux <- abs( df$networth -  wealth$networth )}
\CommentTok{# summary(abs(diff_aux))}
\CommentTok{#     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. }
\CommentTok{#    0.000    0.000    0.008    0.928    0.174 3328.000 }

\NormalTok{total_wealth_scf_in <-}\StringTok{ }\NormalTok{df_scf }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(networth }\OperatorTok{*}\StringTok{ }\NormalTok{wgt)}\OperatorTok{/}\FloatTok{1e12}\NormalTok{) }\OperatorTok{%>%}\StringTok{  }\KeywordTok{as.numeric}\NormalTok{()}
\NormalTok{total_wealth_in <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(networth }\OperatorTok{*}\StringTok{ }\NormalTok{weight)}\OperatorTok{/}\FloatTok{1e12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The total household net worth projection is \$94 trillion for 2019 (the
SCF records a total household net worth of \$87 trillion in 2016).

\hypertarget{generating-percentiles-and-micro-percentiles}{%
\paragraph{3.2 Generating Percentiles and
micro-percentiles}\label{generating-percentiles-and-micro-percentiles}}

In this section, the microdata generated before (\texttt{wealth.dta}) is
aggregated in to percentiles and fractions of a percentile. The final
analytic file contains: percentile or fraction of percentile
(\texttt{gperc}), number of households in that group (\texttt{nb}),
lowest level of wealth in that group (\texttt{thres}) and average level
of wealth in that group (\texttt{avg})

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{*}\CommentTok{# The code below does not run as part of the dynamic document and is presented only}
\ErrorTok{*}\CommentTok{# for reproducibility purposes.}
\ErrorTok{*}\CommentTok{# To run the code below you will require a license of Stata 11 or higher. You will also need to }
\ErrorTok{*}\CommentTok{# place a copy of the file 'gperc.ado', located in the 'rawdata' folder of this repository }
\ErrorTok{*}\CommentTok{# into your ado folder.   }
\NormalTok{global ado_dir }\StringTok{"INCLUDE YOUR FILE PATH FOR DATA HERE"}
\NormalTok{global  datawork   }\StringTok{"INCLUDE YOUR FILE PATH FOR ADOs HERE"}

\NormalTok{sysdir set PERSONAL }\StringTok{"$ado_dir"}

\OperatorTok{*}\StringTok{ }\NormalTok{creating an excel table }\ControlFlowTok{for}\NormalTok{ the simulation}
\NormalTok{use }\OperatorTok{$}\NormalTok{datawork}\OperatorTok{/}\NormalTok{wealth.dta, clear}
\NormalTok{gperc networth [w=weight], }\KeywordTok{matname}\NormalTok{(wealthperc)  }
\NormalTok{mat list wealthperc }
\NormalTok{clear}
\NormalTok{svmat wealthperc, }\KeywordTok{names}\NormalTok{(col)}
\NormalTok{qui compress}
\NormalTok{export excel using }\StringTok{"$datawork/wealthperc.xlsx"}\NormalTok{, }\KeywordTok{first}\NormalTok{(var) replace}
\OperatorTok{*}\NormalTok{REPLACE AT THE END}
\OperatorTok{*}\NormalTok{export delimited using }\StringTok{"/Users/fhoces/Desktop/sandbox/opa-wealthtax/analysis_data/tax_grid.csv"}\NormalTok{, replace}
\end{Highlighting}
\end{Shaded}

\hypertarget{number-of-affected-households-and-their-total-tax-base}{%
\subsubsection{4 - Number of affected households and their total tax
base}\label{number-of-affected-households-and-their-total-tax-base}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# TO DELETE}

\CommentTok{# - inputs: evasion_param_in, wealth_last_400_so, average_wealth_top_400_so,  }
\CommentTok{# cum_numberTaxpayers_scf_so, cum_numberTaxpayers_dina_so, cum_tax_base_scf_so,  }
\CommentTok{# cum_tax_base_dina_so }
\CommentTok{# - outputs: non_evaded_tax_in, totax_last_400_in, totax_average_400_in, totax_total_400_in, }
\CommentTok{# pareto_scale_in, ratio1_in, missing_fraction_in, missing_taxbase_in, num_billionares_in, }
\CommentTok{# final_taxbase_b_in, top_tax_rev_in, cum_numberTaxpayers_scf_in, cum_numberTaxpayers_dina_in, }
\CommentTok{# cum_tax_base_scf_in, cum_tax_base_dina_in }
\NormalTok{est_billionares_in_f <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{evasion_param_var =}\NormalTok{ evasion_param_in, }
                                 \DataTypeTok{wealth_last_400_var =}\NormalTok{ wealth_last_}\DecValTok{400}\NormalTok{_so,}
                                 \DataTypeTok{average_wealth_top_400_var =}\NormalTok{ average_wealth_top_}\DecValTok{400}\NormalTok{_so,}
                                 \DataTypeTok{cum_numberTaxpayers_scf_var =}\NormalTok{ cum_numberTaxpayers_scf_so,}
                                 \DataTypeTok{cum_numberTaxpayers_dina_var =}\NormalTok{ cum_numberTaxpayers_dina_so, }
                                 \DataTypeTok{cum_tax_base_scf_var =}\NormalTok{ cum_tax_base_scf_so, }
                                 \DataTypeTok{cum_tax_base_dina_var =}\NormalTok{ cum_tax_base_dina_so)\{}
\NormalTok{    non_evaded_tax_in <-}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{-}\StringTok{ }\NormalTok{evasion_param_var)}
     
    \CommentTok{# Post evasion taxable wealth}
\NormalTok{    totax_last_}\DecValTok{400}\NormalTok{_in <-}\StringTok{ }\NormalTok{non_evaded_tax_in }\OperatorTok{*}\StringTok{ }\NormalTok{wealth_last_}\DecValTok{400}\NormalTok{_var}\OperatorTok{/}\FloatTok{1e9}                 
\NormalTok{    totax_average_}\DecValTok{400}\NormalTok{_in <-}\StringTok{ }\NormalTok{non_evaded_tax_in }\OperatorTok{*}\StringTok{ }\NormalTok{average_wealth_top_}\DecValTok{400}\NormalTok{_var}\OperatorTok{/}\FloatTok{1e9}       
\NormalTok{    totax_total_}\DecValTok{400}\NormalTok{_in <-}\StringTok{ }\DecValTok{400} \OperatorTok{*}\StringTok{ }\NormalTok{(totax_average_}\DecValTok{400}\NormalTok{_in }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)                     }\CommentTok{# above one billion}
      
    \CommentTok{# Compute pareto scale of wealth distribution}
\NormalTok{    aux1 <-}\StringTok{ }\NormalTok{average_wealth_top_}\DecValTok{400}\NormalTok{_var}\OperatorTok{/}\NormalTok{wealth_last_}\DecValTok{400}\NormalTok{_var}
\NormalTok{    pareto_scale_in <-}\StringTok{ }\NormalTok{aux1}\OperatorTok{/}\NormalTok{(aux1}\DecValTok{-1}\NormalTok{) }
\NormalTok{    ratio1_in <-}\StringTok{ }\KeywordTok{round}\NormalTok{(aux1, }\DecValTok{1}\NormalTok{)}
    
    \CommentTok{# Compute missing fraction of taxable wealth above 1 billion}
\NormalTok{    one_billion <-}\StringTok{ }\DecValTok{1} 
\NormalTok{    missing_fraction_in <-}\StringTok{ }\NormalTok{( totax_last_}\DecValTok{400}\NormalTok{_in }\OperatorTok{/}\StringTok{ }\NormalTok{one_billion )}\OperatorTok{^}\NormalTok{( pareto_scale_in }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{ ) }\OperatorTok{-}\StringTok{ }\DecValTok{1}

    \CommentTok{# Compute missing wealth (billions of dollars) to tax above one billion dollars}
\NormalTok{    missing_taxbase_in <-}\StringTok{ }\NormalTok{missing_fraction_in }\OperatorTok{*}\StringTok{ }\NormalTok{totax_total_}\DecValTok{400}\NormalTok{_in}

    \CommentTok{# Compute total number of billionares. Extrapolation from forbes 400. }
    \CommentTok{#Diff between original document (911) and below (906) is due to rounding in inputs }
\NormalTok{    num_billionares_in <-}\StringTok{ }\DecValTok{400} \OperatorTok{*}\StringTok{ }\NormalTok{( totax_last_}\DecValTok{400}\NormalTok{_in }\OperatorTok{/}\StringTok{ }\DecValTok{1}\NormalTok{ ) }\OperatorTok{^}\StringTok{ }\NormalTok{pareto_scale_in }
\NormalTok{    final_taxbase_b_in <-}\StringTok{ }\NormalTok{totax_total_}\DecValTok{400}\NormalTok{_in }\OperatorTok{+}\StringTok{ }\NormalTok{missing_taxbase_in}

    \CommentTok{#This is the taxed money (the aboves is the totale taxable) in billions  (minus one is just to match original results)}
\NormalTok{    top_tax_rev_in <-}\StringTok{ }\NormalTok{final_taxbase_b_in }\OperatorTok{*}\StringTok{ }\FloatTok{0.01}                                     \CommentTok{# }\AlertTok{ALERT}\CommentTok{: Hard coded number}
     
    \CommentTok{#edit the number of billionares}
\NormalTok{    cum_numberTaxpayers_scf_in <-}\StringTok{ }\KeywordTok{c}\NormalTok{(cum_numberTaxpayers_scf_var[}\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{], num_billionares_in)}
\NormalTok{    cum_numberTaxpayers_dina_in <-}\StringTok{ }\KeywordTok{c}\NormalTok{(cum_numberTaxpayers_dina_var[}\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{], num_billionares_in)}
    \CommentTok{#edit the tax revenue for billionares    }
\NormalTok{    cum_tax_base_scf_in <-}\StringTok{ }\KeywordTok{c}\NormalTok{(cum_tax_base_scf_var[}\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{], top_tax_rev_in)}
\NormalTok{    cum_tax_base_dina_in <-}\StringTok{ }\KeywordTok{c}\NormalTok{(cum_tax_base_dina_var[}\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{], top_tax_rev_in)}
    
    \KeywordTok{return}\NormalTok{( }\KeywordTok{list}\NormalTok{( }\StringTok{"non_evaded_tax_in"}\NormalTok{ =}\StringTok{ }\NormalTok{non_evaded_tax_in, }\StringTok{"totax_last_400_in"}\NormalTok{ =}\StringTok{ }\NormalTok{totax_last_}\DecValTok{400}\NormalTok{_in, }
                  \StringTok{"totax_average_400_in"}\NormalTok{ =}\StringTok{ }\NormalTok{totax_average_}\DecValTok{400}\NormalTok{_in, }\StringTok{"totax_total_400_in"}\NormalTok{ =}\StringTok{ }
\StringTok{                    }\NormalTok{totax_total_}\DecValTok{400}\NormalTok{_in, }\StringTok{"pareto_scale_in"}\NormalTok{ =}\StringTok{ }\NormalTok{pareto_scale_in, }\StringTok{"ratio1_in"}\NormalTok{ =}\StringTok{ }\NormalTok{ratio1_in, }
                  \StringTok{"missing_fraction_in"}\NormalTok{ =}\StringTok{ }\NormalTok{missing_fraction_in, }\StringTok{"missing_taxbase_in"}\NormalTok{ =}\StringTok{ }
\StringTok{                    }\NormalTok{missing_taxbase_in, }\StringTok{"num_billionares_in"}\NormalTok{ =}\StringTok{ }\NormalTok{num_billionares_in, }
                  \StringTok{"final_taxbase_b_in"}\NormalTok{ =}\StringTok{ }\NormalTok{final_taxbase_b_in, }\StringTok{"top_tax_rev_in"}\NormalTok{ =}\StringTok{ }\NormalTok{top_tax_rev_in, }
                  \StringTok{"cum_numberTaxpayers_scf_in"}\NormalTok{ =}\StringTok{ }\NormalTok{cum_numberTaxpayers_scf_in, }
                  \StringTok{"cum_numberTaxpayers_dina_in"}\NormalTok{ =}\StringTok{ }\NormalTok{cum_numberTaxpayers_dina_in, }
                  \StringTok{"cum_tax_base_scf_in"}\NormalTok{ =}\StringTok{ }\NormalTok{cum_tax_base_scf_in, }
                  \StringTok{"cum_tax_base_dina_in"}\NormalTok{ =}\StringTok{ }\NormalTok{cum_tax_base_dina_in ) )}
\NormalTok{\}}

\KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{est_billionares_in_f}\NormalTok{(),.GlobalEnv) )}
\CommentTok{#rm(list = c("aux1", "one_billion"))}
\end{Highlighting}
\end{Shaded}

To compute the relevant universe the evasion parameter of 16\% is
applied to both the threshold and the average wealth of each percentile
(and fraction of a percentile)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# tax_base_grid ---> }
\CommentTok{# Change the following line at the end.}
\CommentTok{#grid <- read.csv("analysis_data/tax_grid.csv")  %>% }
\NormalTok{grid <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"analysis_data/taxBaseGridUpdated.csv"}\NormalTok{)  }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gperc))}
\CommentTok{# print(head(grid)) ## check that app has access to this file}

\CommentTok{# Wealth per bin (percentile) after evasion  }
\NormalTok{grid}\OperatorTok{$}\NormalTok{thresNew <-}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{-}\StringTok{ }\NormalTok{evasion_param_in) }\OperatorTok{*}\StringTok{ }\NormalTok{grid}\OperatorTok{$}\NormalTok{thres}
\NormalTok{grid}\OperatorTok{$}\NormalTok{avgNew <-}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{-}\StringTok{ }\NormalTok{evasion_param_in) }\OperatorTok{*}\StringTok{ }\NormalTok{grid}\OperatorTok{$}\NormalTok{avg }

\CommentTok{# TO DELETE? }
\CommentTok{###### The following section depends on the cleaning data chunk}
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{FALSE}\NormalTok{)\{}
\CommentTok{#QUESTION: Why counts from original source differ?}
\CommentTok{#    df_dina1 %>% filter(networth>50e6) %>% summarise(sum(weight))}
\CommentTok{#    grid %>% filter(thresNew>50e6) %>% summarise(sum(nb))}
\CommentTok{#    df_scf %>% filter(networth>50e6) %>% summarise(sum(weight))}
\NormalTok{target_hhlds_mo <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(networth}\OperatorTok{>}\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(weight)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{as.numeric}\NormalTok{()}
\NormalTok{target_hhlds_round <-}\StringTok{ }\KeywordTok{round}\NormalTok{(target_hhlds_mo}\OperatorTok{/}\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{1000}

\NormalTok{target_hhlds_scf_mo <-}\StringTok{ }\NormalTok{df_scf1 }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(networth}\OperatorTok{>}\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(weight)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{as.numeric}\NormalTok{()}
\NormalTok{target_hhlds_round_scf <-}\StringTok{ }\KeywordTok{round}\NormalTok{(target_hhlds_scf_mo}\OperatorTok{/}\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{1000}

\NormalTok{target_hhlds_dina_mo <-}\StringTok{ }\NormalTok{df_dina1 }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(networth}\OperatorTok{>}\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(weight)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{as.numeric}\NormalTok{()}
\NormalTok{target_hhlds_round_dina <-}\StringTok{ }\KeywordTok{round}\NormalTok{(target_hhlds_dina_mo}\OperatorTok{/}\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{1000}

\NormalTok{\}}

\CommentTok{##### Num hhlds:}
\CommentTok{#no avoidance}
\NormalTok{target_hhlds_noav_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thres }\OperatorTok{>}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(nb))}
\NormalTok{target_hhlds_noav_round <-}\StringTok{ }\KeywordTok{format}\NormalTok{(}\KeywordTok{round}\NormalTok{(target_hhlds_noav_mo }\OperatorTok{/}\StringTok{ }\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{1000}\NormalTok{ , }\DataTypeTok{scientific =} \OtherTok{FALSE}\NormalTok{)}

\CommentTok{#with avoidance}
\NormalTok{target_hhlds_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thresNew }\OperatorTok{>}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(nb))}
\NormalTok{target_hhlds_round <-}\StringTok{ }\KeywordTok{format}\NormalTok{(}\KeywordTok{round}\NormalTok{(target_hhlds_mo }\OperatorTok{/}\StringTok{ }\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{1000}\NormalTok{, }\DataTypeTok{scientific =} \OtherTok{FALSE}\NormalTok{)}

\CommentTok{### Billionares:}
\CommentTok{#no avoidance}
\NormalTok{target_hhlds_bn_noav_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thres }\OperatorTok{>}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(nb))}
\NormalTok{target_hhlds_bn_noav_round <-}\StringTok{ }\KeywordTok{round}\NormalTok{(target_hhlds_bn_noav_mo }\OperatorTok{/}\StringTok{ }\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{1000} 

\CommentTok{#with avoidance}
\NormalTok{target_hhlds_bn_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thresNew }\OperatorTok{>}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{(nb))}
\NormalTok{target_hhlds_bn_round <-}\StringTok{ }\KeywordTok{round}\NormalTok{(target_hhlds_bn_mo }\OperatorTok{/}\StringTok{ }\DecValTok{1000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{1000} 

\CommentTok{##### Total Taxable Wealth:}
\NormalTok{tax_base_total_noav_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thres }\OperatorTok{>}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{((avg }\OperatorTok{-}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{*}\StringTok{ }\NormalTok{nb)}\OperatorTok{/}\FloatTok{1e12}\NormalTok{)}

\CommentTok{#with avoidance}
\CommentTok{#2% above 50m}
\NormalTok{tax_base_total_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thresNew }\OperatorTok{>}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{((avgNew }\OperatorTok{-}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{*}\StringTok{ }\NormalTok{nb)}\OperatorTok{/}\FloatTok{1e12}\NormalTok{)}

\CommentTok{#billionares additional 1%}
\NormalTok{tax_base_total_surtax_noav_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thres }\OperatorTok{>}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{((avg }\OperatorTok{-}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{*}\StringTok{ }\NormalTok{nb)}\OperatorTok{/}\FloatTok{1e12}\NormalTok{)}
\NormalTok{tax_base_total_surtax_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(thresNew }\OperatorTok{>}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{((avgNew }\OperatorTok{-}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{*}\StringTok{ }\NormalTok{nb)}\OperatorTok{/}\FloatTok{1e12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In 2019, there would be around 63000 households liable to the wealth tax
(78000 before accounting for avoidance). This would be less than 0.05\%
of the 130 million US households in 2019.

\hypertarget{tax-to-all-wealth-above-50-millions}{%
\paragraph{4.1 - 2\% tax to all wealth above \$50
millions}\label{tax-to-all-wealth-above-50-millions}}

The 62589 households with assests above \$50 million dollars would have
a total taxable wealth (above the \$50m each) of \$8.9 trillion,
i.e.~approximately 10\% of the \$94 trillion population-wide total
household net worth.

\hypertarget{additional-tax-to-all-wealth-above-1-billion}{%
\paragraph{4.2 - 1\% additional tax to all wealth above \$1
billion}\label{additional-tax-to-all-wealth-above-1-billion}}

The 963 households with assests above \$1 billion dollars would have a
total taxable wealth (above the \$1b each) of \$2.2 trillion,
i.e.~approximately 2\% of the \$94 trillion population-wide total
household net worth.

\hypertarget{total-tax-revenue-in-one-year}{%
\subsubsection{5 - Total tax revenue in one
year}\label{total-tax-revenue-in-one-year}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Total tax collected in a year}
\CommentTok{# amount from 2%}
\CommentTok{# amount from extra 1%}

\CommentTok{#This function computes the total tax collected for a tax unit with wealth "wealth_var", applying "taxrates_var" to "brackets_var"}
\CommentTok{# - inputs: wealth, tax rates, brackets to tax}
\CommentTok{# - ouputs: total tax collected}
\NormalTok{get_tax_rev <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{wealth_var =}\NormalTok{ wealth_aux, }\DataTypeTok{taxrates_var =}\NormalTok{ tax_rates_po,}
                          \DataTypeTok{brackets_var =}\NormalTok{ brackets_po) \{}
    \CommentTok{## expecting taxLevels in percentage}
    \CommentTok{# taxLevels <- taxLevels / 100}
    \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(brackets_var) }\OperatorTok{!=}\StringTok{ }\KeywordTok{length}\NormalTok{(taxrates_var))\{}
      \KeywordTok{stop}\NormalTok{(}\StringTok{"Tax brackets and tax rates do not match"}\NormalTok{)}
\NormalTok{    \}}
   \CommentTok{# Compute max taxable wealth per bracket}
\NormalTok{    max_tax_per_brack <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{diff}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, brackets_var)), }\FloatTok{1e100}\NormalTok{)}
   \CommentTok{# Substract wealth minus tax bracket. If wealth above a given bracket (difference is larger than max taxable wealth), }
   \CommentTok{# then assign max taxable wealth to that given bracket}
\NormalTok{    to_tax <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{( wealth_var }\OperatorTok{-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, brackets_var) }\OperatorTok{>}\StringTok{ }\NormalTok{max_tax_per_brack, }
\NormalTok{                      max_tax_per_brack, }
\NormalTok{                      ( wealth_var }\OperatorTok{-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,brackets_var) ) )   }
   \CommentTok{# If wealth if lower than a given bracket (difference between wealth and bracket is negative), then assign zero to that bracket  }
\NormalTok{    to_tax <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{( to_tax}\OperatorTok{<}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, to_tax )}
    \CommentTok{# Apply trax rates to each corresponding bracket and all together}
\NormalTok{    total_tax <-}\StringTok{ }\KeywordTok{sum}\NormalTok{( to_tax }\OperatorTok{*}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxrates_var) )   }
    \KeywordTok{return}\NormalTok{(total_tax)}
\NormalTok{\}}

\CommentTok{# IMPORTANT: this (similar to getTaxBasePerBracket) was differing from simple}
\CommentTok{# calculation below because this was not subseting to wealth above 50m.}
\CommentTok{# computes tax payed by each average wealth per percintile (up to 2%)}

\CommentTok{## gets taxes paid per group (percentile and micropercentile)}
\NormalTok{get_tax_rev_per_group <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{grid_var =}\NormalTok{ grid, }\DataTypeTok{taxLevels_var =}\NormalTok{ tax_rates_po, }\DataTypeTok{brackets_var1 =}\NormalTok{ brackets_po) \{}
\NormalTok{  grid_var <-}\StringTok{ }\NormalTok{grid_var }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(thresNew }\OperatorTok{>}\StringTok{ }\NormalTok{starting_brack_po)}
\NormalTok{  aux_var <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(grid_var}\OperatorTok{$}\NormalTok{avgNew, }
                   \ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{get_tax_rev}\NormalTok{(}\DataTypeTok{wealth_var =}\NormalTok{ x, }
                                             \DataTypeTok{taxrates_var =}\NormalTok{ taxLevels_var, }
                                             \DataTypeTok{brackets_var =}\NormalTok{ brackets_var1))}
  \KeywordTok{return}\NormalTok{(}\KeywordTok{sum}\NormalTok{(grid_var}\OperatorTok{$}\NormalTok{nb }\OperatorTok{*}\StringTok{ }\NormalTok{aux_var) }\OperatorTok{/}\StringTok{ }\FloatTok{1e9}\NormalTok{)}
\NormalTok{\}}

\NormalTok{tax_rev_init_mo <-}\StringTok{ }\KeywordTok{get_tax_rev_per_group}\NormalTok{(}\DataTypeTok{taxLevels =} \KeywordTok{c}\NormalTok{(tax_rates_po[}\OperatorTok{-}\DecValTok{7}\NormalTok{], }\FloatTok{0.02}\NormalTok{))}
\NormalTok{top_tax_rev_in <-}\StringTok{ }\KeywordTok{get_tax_rev_per_group}\NormalTok{(}\DataTypeTok{taxLevels =} \KeywordTok{c}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{6}\NormalTok{), }\FloatTok{0.01}\NormalTok{))}
\NormalTok{total_tax_rev <-}\StringTok{ }\KeywordTok{get_tax_rev_per_group}\NormalTok{(}\DataTypeTok{taxLevels =}\NormalTok{ tax_rates_po)}
\CommentTok{#199.7889}

\CommentTok{# The following replicates stata code more closely and seems more straightforward. }
\CommentTok{# Howevere it differs more from the code in the app. Consider this in both (app and DD)}
\CommentTok{# in the future}
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{FALSE}\NormalTok{)\{}
    \CommentTok{#with avoidance}
    \CommentTok{#2% above 50m}
\NormalTok{    tax_rev_init_mo <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{      }\KeywordTok{filter}\NormalTok{(thresNew }\OperatorTok{>}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{      }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{((avgNew }\OperatorTok{-}\StringTok{ }\NormalTok{starting_brack_po) }\OperatorTok{*}\StringTok{ }\NormalTok{nb }\OperatorTok{*}\StringTok{ }\FloatTok{0.02}\NormalTok{)}\OperatorTok{/}\FloatTok{1e9}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{()}
    
    \CommentTok{#billionares additional 1%}
\NormalTok{    top_tax_rev_in <-}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{      }\KeywordTok{filter}\NormalTok{(thresNew }\OperatorTok{>}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{%>%}\StringTok{ }
\StringTok{      }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{sum}\NormalTok{((avgNew }\OperatorTok{-}\StringTok{ }\NormalTok{next_increase_po) }\OperatorTok{*}\StringTok{ }\NormalTok{nb }\OperatorTok{*}\StringTok{ }\FloatTok{0.01}\NormalTok{)}\OperatorTok{/}\FloatTok{1e9}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{()}
    
\NormalTok{    total_tax_rev <-}\StringTok{ }\NormalTok{total_tax_base }\OperatorTok{+}\StringTok{ }\NormalTok{total_tax_sur_bill}
\NormalTok{\}}

\CommentTok{# TO DELETE ALL BELOW?}
\NormalTok{getPeoplePerBracket=}\ControlFlowTok{function}\NormalTok{(grid, brackets)\{}
\NormalTok{  brackets =}\StringTok{ }\KeywordTok{c}\NormalTok{(brackets, }\FloatTok{1e12}\NormalTok{) }\CommentTok{## get last bracket}
\NormalTok{  grid}\OperatorTok{$}\NormalTok{group=}\KeywordTok{cut}\NormalTok{(grid}\OperatorTok{$}\NormalTok{thresNew, brackets)}
\NormalTok{  toReturn =}\StringTok{ }\NormalTok{grid }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{group_by}\NormalTok{(group) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{totalPeople=}\KeywordTok{sum}\NormalTok{(nb)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{drop_na}\NormalTok{()}
  \KeywordTok{return}\NormalTok{(toReturn)}
\NormalTok{\}}

\NormalTok{numberTaxpayers <-}\StringTok{ }\KeywordTok{getPeoplePerBracket}\NormalTok{(}\DataTypeTok{brackets =}\NormalTok{ brackets_po, }\DataTypeTok{grid =}\NormalTok{ grid)}

\CommentTok{#Revenue}
\CommentTok{#From here on: keep}
\NormalTok{target_hhlds_mo <-}\StringTok{ }\KeywordTok{sum}\NormalTok{( numberTaxpayers}\OperatorTok{$}\NormalTok{totalPeople[brackets_po}\OperatorTok{>=}\NormalTok{starting_brack_po] )}

\CommentTok{# tax_base_total_mo}
\CommentTok{# tax_rev_init_mo}
\CommentTok{# final_taxbase_b_in tax_base_total_noav_mo}
\CommentTok{# num_billionares_in}
\CommentTok{# top_tax_rev_in}
\CommentTok{# total_rev_pe}
\CommentTok{#go with wealthperc and highlight discrepe =   }
\CommentTok{#tax_base_total_mo <- sum(taxBase$taxBase[brackets_po>=starting_brack_po])/1e12* main_tax_po * 1000}
\CommentTok{#tax_rev_init_mo <-   tax_base_total_mo * main_tax_po * 1000}
\end{Highlighting}
\end{Shaded}

Starting with the \$8.9 trillion tax base of wealth above \$50 million
(\$11.4 with no avoidance), a two percent tax would raise \$178 billion
in 2019. The billionaire surtax is estimated to apply to a base of \$2.2
trillion (\$2.8 with no avoidance) from about 1000 billionaire families
(1300 with no avoidance). Thus the billionaire surtax would raise \$22
billion in 2019. The combination of the 2\% tax above \$50 million and
the billionaire surtax would raise 178 + 22 = 200 billion in 2019.

\hypertarget{visualization}{%
\subsubsection{5.1 - Visualization}\label{visualization}}

The figure below illustrates the distribution of wealth tax across the
population:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Clean up the code (but do not make changes). }
\NormalTok{taxRate <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{) }
\NormalTok{brackets <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{500}\NormalTok{, }\DecValTok{1000}\NormalTok{)}
\CommentTok{#this section sorts the tax brackets. Not needed outside the app    }
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{FALSE}\NormalTok{)\{          }
    \CommentTok{## reshuffle to make sure brackets are increasing}
    \CommentTok{## tax rates not forced to be monotonic}
\NormalTok{    reorderIdx <-}\StringTok{ }\KeywordTok{order}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets))}
\NormalTok{    brackets <-}\StringTok{ }\NormalTok{brackets[reorderIdx]}
\NormalTok{    taxRate <-}\StringTok{ }\NormalTok{taxRate[reorderIdx]}
\NormalTok{\}}
    
\CommentTok{### KATIE: change the 1e5 to whatever you want to be the minimum}
\NormalTok{xval <-}\StringTok{ }\DecValTok{10}\OperatorTok{^}\KeywordTok{seq}\NormalTok{(}\KeywordTok{log10}\NormalTok{(}\FloatTok{1e5}\NormalTok{), }\KeywordTok{log10}\NormalTok{(}\FloatTok{45e9}\NormalTok{), }\DataTypeTok{by =} \FloatTok{0.001}\NormalTok{) }\CommentTok{## get uniform on log scale}
 
\ControlFlowTok{if}\NormalTok{(}\OtherTok{FALSE}\NormalTok{)\{}
\NormalTok{    idx0 <-}\StringTok{ }\NormalTok{xval }\OperatorTok{<=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{1}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}
\NormalTok{    idx1 <-}\StringTok{ }\NormalTok{xval }\OperatorTok{<=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{2}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6} \OperatorTok{&}\StringTok{ }\NormalTok{xval }\OperatorTok{>}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{1}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}
\NormalTok{    idx2 <-}\StringTok{ }\NormalTok{xval }\OperatorTok{>}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{2}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6} \OperatorTok{&}\StringTok{ }\NormalTok{xval }\OperatorTok{<=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{3}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}
\NormalTok{    idx3 <-}\StringTok{ }\NormalTok{xval }\OperatorTok{>}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{3}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6} \OperatorTok{&}\StringTok{ }\NormalTok{xval }\OperatorTok{<=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{4}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}
\NormalTok{    idx4 <-}\StringTok{ }\NormalTok{xval }\OperatorTok{>}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{4}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}
\NormalTok{    idx <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(idx0, idx1, idx2, idx3, idx4)}
   \CommentTok{# Indicator across income on tax bracket position}
\NormalTok{    getGroup <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}\KeywordTok{apply}\NormalTok{(idx, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) \{}
      \KeywordTok{which}\NormalTok{(x)[}\DecValTok{1}\NormalTok{]}
\NormalTok{    \}))}

\NormalTok{    toPlot <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(xval, getGroup)  }
\NormalTok{\}}
    \CommentTok{#brackets_po <- c(0, 25, 50, 100, 250, 500, 1000) * 1e6}
\NormalTok{getGroup <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{cut}\NormalTok{(xval, }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, brackets }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\FloatTok{1e12}\NormalTok{), }\DataTypeTok{include.lowest =} \OtherTok{TRUE}\NormalTok{))}

\NormalTok{toPlot <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(xval, getGroup)  }
\CommentTok{#summary(toPlot)}
\CommentTok{#toMatch <- cbind.data.frame(group = 1:7, tax = tax_rates_po)}
\NormalTok{toMatch <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{group =} \DecValTok{1}\OperatorTok{:}\NormalTok{(}\KeywordTok{length}\NormalTok{(taxRate) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{), }\DataTypeTok{tax =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate))}

\NormalTok{toPlot2 <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(toPlot, toMatch, }\DataTypeTok{by.x =} \StringTok{"getGroup"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"group"}\NormalTok{)}

\CommentTok{#lapply(x = 1:5, f(x,y), y = 6:10) = (1, 6:10); (2, 6:10);... ;(5, 6:10)  }
\NormalTok{toPlot2}\OperatorTok{$}\NormalTok{averageInt <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{( toPlot2}\OperatorTok{$}\NormalTok{xval, }
                              \ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{get_tax_rev}\NormalTok{(}\DataTypeTok{wealth_var =}\NormalTok{ x, }
                                                        \DataTypeTok{taxrates_var =}\NormalTok{ taxRate}\OperatorTok{/}\DecValTok{100}\NormalTok{, }
                                                        \DataTypeTok{brackets_var =}\NormalTok{ brackets }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{) )}

\CommentTok{# Here is where the total tax payed by each individuals is transform into average tax rates}
\NormalTok{toPlot2}\OperatorTok{$}\NormalTok{averageRate <-}\StringTok{ }\NormalTok{(toPlot2}\OperatorTok{$}\NormalTok{averageInt }\OperatorTok{/}\StringTok{ }\NormalTok{toPlot2}\OperatorTok{$}\NormalTok{xval) }\OperatorTok{*}\StringTok{ }\DecValTok{100}

\NormalTok{toPlot2}\OperatorTok{$}\NormalTok{id <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(toPlot2)}
\CommentTok{#browser()}
\ControlFlowTok{if}\NormalTok{(}\OtherTok{FALSE}\NormalTok{) \{}
    \CommentTok{# unaffected by new grouping}
\NormalTok{    toPlot2}\OperatorTok{$}\NormalTok{marginalInt <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(toPlot2}\OperatorTok{$}\NormalTok{xval, getAverageTax, taxRate, brackets))}

\NormalTok{    toPlot2}\OperatorTok{$}\NormalTok{marginalRate <-}\StringTok{ }\NormalTok{(toPlot2}\OperatorTok{$}\NormalTok{marginalInt }\OperatorTok{/}\StringTok{ }\NormalTok{toPlot2}\OperatorTok{$}\NormalTok{xval) }\OperatorTok{*}\StringTok{ }\DecValTok{100}

\NormalTok{    toPlot2}\OperatorTok{$}\NormalTok{id <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(toPlot2)}
\NormalTok{\}}
\CommentTok{#summary(toPlot2)}
\CommentTok{#end of dataInputT}
       
 \CommentTok{#  }
 \CommentTok{#      getGroup          xval                tax         marginalInt         marginalRate          id      }
 \CommentTok{# Min.   :1.000   Min.   :1.000e+05   Min.   :0.000   Min.   :0.000e+00   Min.   :0.0000   Min.   :   1  }
 \CommentTok{# 1st Qu.:1.000   1st Qu.:2.590e+06   1st Qu.:0.000   1st Qu.:0.000e+00   1st Qu.:0.0000   1st Qu.:1414  }
 \CommentTok{# Median :3.000   Median :6.707e+07   Median :2.000   Median :3.413e+05   Median :0.5089   Median :2828  }
 \CommentTok{# Mean   :2.807   Mean   :3.459e+09   Mean   :1.338   Mean   :9.947e+07   Mean   :1.1090   Mean   :2828  }
 \CommentTok{# 3rd Qu.:5.000   3rd Qu.:1.737e+09   3rd Qu.:3.000   3rd Qu.:4.110e+07   3rd Qu.:2.3667   3rd Qu.:4241  }
 \CommentTok{# Max.   :5.000   Max.   :4.498e+10   Max.   :3.000   Max.   :1.338e+09   Max.   :2.9755   Max.   :5654 }
 \CommentTok{#  }
  
  
\CommentTok{# These are mini data set that ggvis needs to create vertical lines}
\NormalTok{extra0 <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{1}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate[}\DecValTok{1}\NormalTok{]))}
\NormalTok{extra1 <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{2}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate[}\DecValTok{1}\NormalTok{]))}
\NormalTok{extra1b <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{2}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate[}\DecValTok{2}\NormalTok{]))}
\NormalTok{extra2 <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{3}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate[}\DecValTok{2}\NormalTok{]))}
\NormalTok{extra2b <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{3}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate[}\DecValTok{3}\NormalTok{]))}
\NormalTok{extra3 <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{4}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate[}\DecValTok{3}\NormalTok{]))}
\NormalTok{extra3b <-}\StringTok{ }\KeywordTok{cbind.data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(brackets[}\DecValTok{4}\NormalTok{]) }\OperatorTok{*}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, taxRate[}\DecValTok{4}\NormalTok{]))}

\NormalTok{showAvg <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
  \CommentTok{# https://stackoverflow.com/questions/28396900/r-ggvis-html-function-failing-to-add-tooltip/28399656#28399656}
  \CommentTok{# https://stackoverflow.com/questions/31230124/exclude-line-points-from-showing-info-when-using-add-tooltip-with-hover-in-ggvis}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{sum}\NormalTok{(}\KeywordTok{grepl}\NormalTok{(}\StringTok{"id"}\NormalTok{, }\KeywordTok{names}\NormalTok{(x))) }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) }\KeywordTok{return}\NormalTok{(}\OtherTok{NULL}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{is.null}\NormalTok{(x)) }\KeywordTok{return}\NormalTok{(}\OtherTok{NULL}\NormalTok{)}
  
\NormalTok{  data <-}\StringTok{ }\NormalTok{toPlot2}

\NormalTok{  row <-}\StringTok{ }\NormalTok{data[data}\OperatorTok{$}\NormalTok{id }\OperatorTok{==}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{id, ]}

  \CommentTok{#The following section does not work in the static plot}
  \ControlFlowTok{if}\NormalTok{(}\OtherTok{FALSE}\NormalTok{)\{}
  \KeywordTok{paste0}\NormalTok{(}\StringTok{"Average Tax Rate: "}\NormalTok{, }\KeywordTok{round}\NormalTok{(row}\OperatorTok{$}\NormalTok{averageRate, }\DecValTok{2}\NormalTok{), }\StringTok{"%"}\NormalTok{, }
         \StringTok{" <br> Wealth ($m): "}\NormalTok{, }\KeywordTok{round}\NormalTok{(row}\OperatorTok{$}\NormalTok{xval }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{0}\NormalTok{), }
         \StringTok{"<br> Top "}\NormalTok{, }\KeywordTok{getPercentile}\NormalTok{(}\KeywordTok{updateGrid}\NormalTok{(), row}\OperatorTok{$}\NormalTok{xval }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{), }
         \StringTok{"%"}\NormalTok{, }\StringTok{"<br> Taxes Paid ($m): "}\NormalTok{, }\KeywordTok{round}\NormalTok{(row}\OperatorTok{$}\NormalTok{averageInt }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DecValTok{2}\NormalTok{), }
         \DataTypeTok{sep =} \StringTok{""}\NormalTok{) }\CommentTok{## dividing by 1e6 may need to change if we do this for xval overall}
\NormalTok{  \}}
\NormalTok{\}}


\NormalTok{data <-}\StringTok{ }\NormalTok{toPlot2}

\NormalTok{rmIdx <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(data)}
\NormalTok{plot <-}\StringTok{ }\NormalTok{data[, }\OperatorTok{-}\NormalTok{rmIdx] }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggvis}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\StringTok{ }\NormalTok{xval }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DataTypeTok{y =} \OperatorTok{~}\NormalTok{tax) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_points}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_points}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ data, }\DataTypeTok{x =} \OperatorTok{~}\StringTok{ }\NormalTok{xval }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DataTypeTok{y =} \OperatorTok{~}\NormalTok{averageRate, stroke }\OperatorTok{:}\ErrorTok{=}\StringTok{ "red"}\NormalTok{, key }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\ErrorTok{~}\NormalTok{id) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_tooltip}\NormalTok{(showAvg, }\StringTok{"hover"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_lines}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\StringTok{ }\NormalTok{xval }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\DataTypeTok{y =} \OperatorTok{~}\NormalTok{averageRate, stroke }\OperatorTok{:}\ErrorTok{=}\StringTok{ "red"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_paths}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ extra1, }\OperatorTok{~}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\OperatorTok{~}\NormalTok{y) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_paths}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ extra2, }\OperatorTok{~}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\OperatorTok{~}\NormalTok{y) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_paths}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ extra3, }\OperatorTok{~}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\OperatorTok{~}\NormalTok{y) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_paths}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ extra0, }\OperatorTok{~}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\OperatorTok{~}\NormalTok{y) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_paths}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ extra1b, }\OperatorTok{~}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\OperatorTok{~}\NormalTok{y) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_paths}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ extra2b, }\OperatorTok{~}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\OperatorTok{~}\NormalTok{y) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layer_paths}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ extra3b, }\OperatorTok{~}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\FloatTok{1e6}\NormalTok{, }\OperatorTok{~}\NormalTok{y) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_axis}\NormalTok{(}\StringTok{"x"}\NormalTok{,}
           \DataTypeTok{title_offset =} \DecValTok{80}\NormalTok{, }\DataTypeTok{title =} \StringTok{"Wealth ($m)"}\NormalTok{, }\DataTypeTok{grid =}\NormalTok{ F, }\DataTypeTok{format =} \StringTok{","}\NormalTok{,}
           \DataTypeTok{values =}\NormalTok{ brackets, }\DataTypeTok{properties =} \KeywordTok{axis_props}\NormalTok{(}\DataTypeTok{labels =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{45}\NormalTok{, }\DataTypeTok{align =} \StringTok{"left"}\NormalTok{, }\DataTypeTok{baseline =} \StringTok{"middle"}\NormalTok{))}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_axis}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\DataTypeTok{title =} \StringTok{"Tax rate (%)"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{scale_numeric}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\DataTypeTok{trans =} \StringTok{"log"}\NormalTok{, }\DataTypeTok{expand =} \DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{set_options}\NormalTok{(}\DataTypeTok{width =} \DecValTok{1000}\NormalTok{, }\DataTypeTok{height =} \DecValTok{500}\NormalTok{)}

\NormalTok{plot}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot_id205564284-container}{}
\hypertarget{plot_id205564284}{}

Renderer: SVG \textbar{} Canvas

Download

\textbf{\href{NULL}{Click here/ADD URL WHEN ALLOWED} to explore
different policy proposal and to see how the assumptions of the analysis
affect the results.}

\textbf{There are two ways to edit the code behind this document:}\\
1 - Download/Clone \href{https://github.com/fhoces/opa-wealthtax}{this
repository} into your computer. You will need to install
\href{https://cloud.r-project.org/}{R} and
\href{https://www.rstudio.com/products/rstudio/download/\#download}{RStudio}.

2 - Go to
\href{https://mybinder.org/v2/gh/fhoces/opa-wealthtax/master?urlpath=rstudio}{this
link} and reproduce all the result in a computing enviroment (supported
by \href{https://mybinder.org/}{project binder}). You will \textbf{not}
need to install anything in your computer.

\hypertarget{ten-year-projections}{%
\subsubsection{6 - Ten year projections}\label{ten-year-projections}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# - inputs: inflation_so, population_gr_so, real_growth_so, total_rev_pe, top_tax_rev_in}
\CommentTok{# - ouputs: discount_rate_mo, ten_year_factor_mo, ten_year_revenue_pe, ten_year_top_tax_pe}
\NormalTok{ten_years_mo_f <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{inflation_var =}\NormalTok{ inflation_so, }\DataTypeTok{population_gr_var =}\NormalTok{ population_gr_so,}
                           \DataTypeTok{real_growth_var =}\NormalTok{ real_growth_so, }\DataTypeTok{total_rev_var =}\NormalTok{ total_tax_rev, }
                           \DataTypeTok{top_tax_base_var =}\NormalTok{ top_tax_rev_in)\{}
  
  
  
\NormalTok{    discount_rate_mo <-}\StringTok{ }\NormalTok{inflation_var }\OperatorTok{+}\StringTok{ }\NormalTok{population_gr_so }\OperatorTok{+}\StringTok{ }\NormalTok{real_growth_so  }
\NormalTok{    ten_year_factor_mo <-}\StringTok{ }\KeywordTok{sum}\NormalTok{( ( }\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{discount_rate_mo )}\OperatorTok{^}\NormalTok{( }\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{ ) ) }

\NormalTok{    ten_year_revenue_pe <-}\StringTok{ }\NormalTok{total_rev_var }\OperatorTok{*}\StringTok{ }\NormalTok{ten_year_factor_mo     }
    \CommentTok{#ten_year_revenue_pe <- total_rev_pe * ten_year_factor_mo                      #PE}
\NormalTok{    ten_year_top_tax_pe <-}\StringTok{ }\NormalTok{top_tax_base_var }\OperatorTok{*}\StringTok{ }\NormalTok{ten_year_factor_mo          }
    \CommentTok{#ten_year_top_tax_pe <- top_tax_base_var * ten_year_factor_mo                  #PE}
    
    
    
    \KeywordTok{return}\NormalTok{( }\KeywordTok{list}\NormalTok{(}\StringTok{"discount_rate_mo"}\NormalTok{ =}\StringTok{ }\NormalTok{discount_rate_mo, }\StringTok{"ten_year_factor_mo"}\NormalTok{ =}\StringTok{ }\NormalTok{ten_year_factor_mo, }
           \StringTok{"ten_year_revenue_pe"}\NormalTok{ =}\StringTok{ }\NormalTok{ten_year_revenue_pe, }\StringTok{"ten_year_top_tax_pe"}\NormalTok{ =}\StringTok{ }\NormalTok{ten_year_top_tax_pe) )}
\NormalTok{\}}

\KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{ten_years_mo_f}\NormalTok{(),.GlobalEnv) )}

\CommentTok{#TO DELETE}
\NormalTok{ten_year_factor_round <-}\StringTok{ }\KeywordTok{round}\NormalTok{(ten_year_factor_mo) }



\CommentTok{# test to run from the beginning (only functions)}
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{FALSE}\NormalTok{) \{}
    \KeywordTok{rm}\NormalTok{(}\DataTypeTok{list =} \KeywordTok{ls}\NormalTok{()[}\OperatorTok{!}\NormalTok{(}\KeywordTok{ls}\NormalTok{() }\OperatorTok{%in%}\StringTok{ }\KeywordTok{ls}\NormalTok{(}\DataTypeTok{pattern =} \StringTok{"_f}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{b"}\NormalTok{))])}
    \KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{call_params_f}\NormalTok{(), .GlobalEnv) )}
    \KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{policy_f}\NormalTok{(), .GlobalEnv) )}
    \KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{tax_elasticity_in_f}\NormalTok{(), .GlobalEnv) )}
    \KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{est_billionares_in_f}\NormalTok{(), .GlobalEnv) )}
    \KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{tax_revenue_mo_f}\NormalTok{(), .GlobalEnv) )}
    \KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{total_rev_mo_f}\NormalTok{(), .GlobalEnv) )}
    \KeywordTok{invisible}\NormalTok{( }\KeywordTok{list2env}\NormalTok{(}\KeywordTok{ten_years_mo_f}\NormalTok{(),.GlobalEnv) )}
    \KeywordTok{sapply}\NormalTok{(}\KeywordTok{ls}\NormalTok{(}\DataTypeTok{pattern =} \StringTok{"_pe}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{b"}\NormalTok{), get)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

To project tax revenues over a 10-year horizon, we assume that nominal
taxable wealth would grow at the same pace as the economy, at 5.5\% per
year as in standard projections of the Congressional Budget Office or
the Joint Committee on Taxation. This growth is decomposed into 2.5\%
price, 1\% population growth, and 2\% of real growth per capita. This
implies that tax revenue over the 10 years 2019-2028 is about 13 times
the revenue raised in 2019\footnote{With r=5.5\%, we have
  {[}1+(1+r)+..+(1+r)\^{}9{]}={[}(1+r)\^{}10-1{]}/r=12.9, approximately
  13.}. This uniform growth assumption is conservative as the wealth of
the rich has grown substantially faster than average in recent decades.
The estimates by Saez and Zucman\footnote{Saez, Emmanuel and Gabriel
  Zucman, ``Wealth Inequality in the United States since 1913: Evidence
  from Capitalized Income Tax Data'', Quarterly Journal of Economics
  131(2), 2016, 519-578, updated series available at
  \url{http://gabriel-zucman.eu/usdina/}} show that, from 1980 to 2016,
real wealth of the top 0.1\% has grown at 5.3\% per year on average,
which is 2.8 points above the average real wealth growth of 2.5\% per
year. Average real wealth of the Forbes 400 has grown even faster at 7\%
per year, 4.5 points above the average. The historical gap in growth
rates of top wealth vs.~average wealth is larger than the proposed
wealth tax. Therefore, even with the wealth tax, it is most likely that
top wealth would continue to grow at least as fast as the average.

This 10-year projection implies that revenue raised by the progressive
wealth tax would be 12.9 * 199.8 = \$2572 billion, rounded to \$2.6
trillion. Out of these \$2.6 trillion, the billionaire surtax would
raise 21.7 * 12.9 = \$278.8 billion, rounded to \$0.3 trillion.

It is important to emphasize that our computations assume that the
wealth tax base is comprehensive with no major asset classes exempt from
wealth taxation. Introducing exemptions for specific asset classes would
reduce the revenue estimates both mechanically and dynamically as
wealthy individuals would shift their wealth into tax exempt assets.
Because your proposal does not include any large exemptions, we do not
believe our revenue estimate needs to be adjusted.

\hypertarget{wealth-inequality}{%
\subsubsection{7 - Wealth inequality}\label{wealth-inequality}}

One of the key motivations for introducing a progressive wealth tax is
to curb the growing concentration of wealth. The top 0.1\% wealth share
has increased dramatically from about 7\% in the late 1970s to around
20\% in recent years. Conversely, the wealth share of the bottom 90\% of
families has declined from about 35\% in the late 1970s to about 25\%
today. This fall has been primarily the consequence of increased debt
for the bottom 90\% (through mortgage refinance, consumer credit, and
student loans). As a result, the top 0.1\% today owns almost as much
wealth as the bottom 90\% of US families, which includes the vast
majority of US families.

\hypertarget{tax-burden-on-the-wealthiest-0.1}{%
\subsubsection{8 - Tax burden on the wealthiest
0.1\%}\label{tax-burden-on-the-wealthiest-0.1}}

The estimates of Piketty, Saez, and Zucman (2018) show that the total
burden (including all taxes both at the federal, state, and local
levels) of the wealthiest 0.1\% families is projected to be 3.2\% of
their wealth in 2019 (they have on average \$116 million in wealth, and
pay total taxes of \$3.68 million). The proposed progressive wealth tax
would add an extra \$1.27 million (or 1.1\% of wealth) to their tax
burden for a total tax burden (relative to wealth) of 4.3\%.

In contrast, the bottom 99\% families have a total tax burden of 7.2\%
relative to their wealth. Their tax burden relative to wealth is much
higher than for the top 0.1\% because the bottom 99\% relies primarily
on labor income, which bears tax but is not part of net worth. In
contrast, the majority of the income of the top 0.1\% wealthiest comes
from returns to their wealth.

\textbf{Note:} Our analysis complies with the highest levels of
transparency and reproducibilty for open policy analysis proposed by the
\href{https://www.bitss.org/opa/}{\emph{Berkeley Initiative for
Transparency in the Social Sciences}}. We invite contributors and
critics of this analysis to follow similar standards.


\end{document}
